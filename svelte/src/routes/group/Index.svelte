<script lang="ts">
	import { preventDefault } from 'svelte/legacy';

	import { onMount } from 'svelte';
	import Header from './Header.svelte';
	// import Tabs from './Tabs.svelte';
	import Tabs from '$lib/components/ui/Tabs.svelte';
	import GroupDetail from './GroupDetail.svelte';
	import { ScrollManager, ScrollDirection } from '$lib/utils/ScrollManager';
	
	// ê·¸ë£¹ ë°ì´í„° íƒ€ì… ì •ì˜
	interface FoodGroup {
		id: string;
		name: string;
		description: string;
		memberCount: number;
		placeCount: number;
		thumbnail: string;
		tags: string[];
		isOfficial: boolean;
		isHot: boolean;
		isNew: boolean;
		isAutoGenerated: boolean; // ì‹œìŠ¤í…œ ìë™í™” ê·¸ë£¹ ì—¬ë¶€
		type?: string; // ê·¸ë£¹ ìœ í˜• (ìë™í™” ê·¸ë£¹ìš©)
	}
	
	// ìŠ¤í¬ë¡¤ ê´€ë ¨ ìƒíƒœ
	let scrollableArea: HTMLElement | null = $state(null);
	let showNav = $state(true);
	
	// ìŠ¤í¬ë¡¤ ë§¤ë‹ˆì € ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
	const scrollManager = new ScrollManager({
		headerThreshold: 5,
		debug: false
	});

	// ìƒì„¸ í˜ì´ì§€ í‘œì‹œ ìƒíƒœ
	let showDetail = $state(false);
	let selectedGroupId = $state<string | null>(null);
	
	// ì¹´í…Œê³ ë¦¬ ë°ì´í„°
	const tabs = [
		{ id: 'all', label: 'ì „ì²´', desc: 'ëª¨ë“  ê·¸ë£¹ì„ í•œëˆˆì— ë³¼ ìˆ˜ ìˆì–´ìš”.' },
		{ id: 'auto', label: 'ì¶”ì²œ ê·¸ë£¹', desc: 'ë‚˜ë¥¼ ìœ„í•´ ìë™ìœ¼ë¡œ ìƒì„±ëœ ë§ì¶¤ ê·¸ë£¹ì´ì—ìš”.' },
		{ id: 'popular', label: 'ì¸ê¸° ê·¸ë£¹', desc: 'ë§ì€ ì‚¬ëŒë“¤ì´ ì°¸ì—¬í•˜ê³  ìˆëŠ” ì¸ê¸° ê·¸ë£¹ì´ì—ìš”.' },
		{ id: 'my', label: 'ë‚´ ê·¸ë£¹', desc: 'ë‚´ê°€ ì°¸ì—¬í•˜ê³  ìˆëŠ” ê·¸ë£¹ì„ ëª¨ì•„ì„œ ë³´ì—¬ë“œë ¤ìš”.' },
		{ id: 'region', label: 'ì§€ì—­ë³„', desc: 'ì§€ì—­ë³„ë¡œ ëª¨ì•„ë‘” ë§›ì§‘ ê·¸ë£¹ì´ì—ìš”.' }
	];
	
	// í™œì„± ì¹´í…Œê³ ë¦¬
	let activeTab = $state(0);
	
	// ê²€ìƒ‰ì–´
	let searchQuery = $state('');
	
	// ê·¸ë£¹ ìƒì„± ëª¨ë‹¬ ìƒíƒœ
	let showCreateModal = $state(false);
	
	// ìë™í™” ê·¸ë£¹ ë°ì´í„° (ì¶”ì²œ ê·¸ë£¹)
	const automatedGroups: FoodGroup[] = [
		{
			id: 'auto-1',
			name: 'ë‚´ ì£¼ë³€ ì¤‘ì‹ë‹¹',
			description: 'ì‚¬ìš©ì ìœ„ì¹˜ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ëœ ì¤‘ì‹ë‹¹ ëª¨ìŒ',
			memberCount: 0,
			placeCount: 15,
			thumbnail: 'https://placehold.co/600x400?text=ì¤‘ì‹ë‹¹',
			tags: ['ì¤‘ì‹', 'ê·¼ì²˜', 'ìë™í™”'],
			isOfficial: false,
			isHot: false,
			isNew: true,
			isAutoGenerated: true,
			type: 'location'
		},
		{
			id: 'auto-2',
			name: 'ë‚´ê°€ ì €ì¥í•œ ë§›ì§‘',
			description: 'ì‚¬ìš©ìê°€ ì €ì¥í•œ ë§›ì§‘ ëª¨ìŒ',
			memberCount: 0,
			placeCount: 8,
			thumbnail: 'https://placehold.co/600x400?text=ì €ì¥ë§›ì§‘',
			tags: ['ì €ì¥', 'ë§›ì§‘', 'ìë™í™”'],
			isOfficial: false,
			isHot: false,
			isNew: true,
			isAutoGenerated: true,
			type: 'saved'
		},
		{
			id: 'auto-3',
			name: 'íšŒì‹í•˜ê¸° ì¢‹ì€ ê³³',
			description: 'ì‚¬ìš©ì ì·¨í–¥ ê¸°ë°˜ ì¶”ì²œ íšŒì‹ ì¥ì†Œ',
			memberCount: 0,
			placeCount: 12,
			thumbnail: 'https://placehold.co/600x400?text=íšŒì‹',
			tags: ['íšŒì‹', 'ë‹¨ì²´', 'ìë™í™”'],
			isOfficial: false,
			isHot: false,
			isNew: true,
			isAutoGenerated: true,
			type: 'recommendation'
		}
	];
	
	// ì‚¬ìš©ì ìƒì„± ê·¸ë£¹ ë°ì´í„°
	const userGroups: FoodGroup[] = [
		{
			id: '1',
			name: 'ì„œìš¸ ë§›ì§‘ íƒí—˜ëŒ€',
			description: 'ì„œìš¸ ìˆ¨ì€ ë§›ì§‘ì„ ì°¾ì•„ì„œ',
			memberCount: 1245,
			placeCount: 67,
			thumbnail: 'https://placehold.co/600x400?text=ì„œìš¸ë§›ì§‘',
			tags: ['ì„œìš¸', 'ë§›ì§‘', 'ë°ì´íŠ¸'],
			isOfficial: false,
			isHot: true,
			isNew: false,
			isAutoGenerated: false
		},
		{
			id: '2',
			name: 'ê°€ì„±ë¹„ ëíŒì™•',
			description: 'ê°€ê²© ëŒ€ë¹„ ë§Œì¡±ë„ê°€ ë†’ì€ ì‹ë‹¹ ëª¨ìŒ',
			memberCount: 987,
			placeCount: 42,
			thumbnail: 'https://placehold.co/600x400?text=ê°€ì„±ë¹„',
			tags: ['ê°€ì„±ë¹„', 'ì €ë ´', 'ëŒ€í•™ìƒ'],
			isOfficial: false,
			isHot: true,
			isNew: false,
			isAutoGenerated: false
		},
		{
			id: '3',
			name: 'í˜¼ë°¥ ë§›ì§‘ ì»¬ë ‰ì…˜',
			description: 'í˜¼ì ë¨¹ê¸° ì¢‹ì€ ì‹ë‹¹ ëª¨ìŒ',
			memberCount: 654,
			placeCount: 29,
			thumbnail: 'https://placehold.co/600x400?text=í˜¼ë°¥',
			tags: ['í˜¼ë°¥', 'í¸ì•ˆí•¨', '1ì¸ë¶„'],
			isOfficial: false,
			isHot: false,
			isNew: false,
			isAutoGenerated: false
		},
		{
			id: '4',
			name: 'ì¸ìŠ¤íƒ€ ê°ì„± ì¹´í˜',
			description: 'ì‚¬ì§„ ì°ê¸° ì¢‹ì€ ê°ì„± ì¹´í˜ ëª¨ìŒ',
			memberCount: 1032,
			placeCount: 45,
			thumbnail: 'https://placehold.co/600x400?text=ê°ì„±ì¹´í˜',
			tags: ['ì¹´í˜', 'ë””ì €íŠ¸', 'ì¸ìŠ¤íƒ€ê·¸ë¨'],
			isOfficial: false,
			isHot: false,
			isNew: true,
			isAutoGenerated: false
		},
		{
			id: '5',
			name: 'ê³ ê¸° ë§ˆë‹ˆì•„',
			description: 'ê³ ê¸° ë§›ì§‘ ëª¨ìŒ',
			memberCount: 876,
			placeCount: 31,
			thumbnail: 'https://placehold.co/600x400?text=ê³ ê¸°',
			tags: ['ê³ ê¸°', 'ì‚¼ê²¹ì‚´', 'ì†Œê³ ê¸°'],
			isOfficial: false,
			isHot: true,
			isNew: false,
			isAutoGenerated: false
		}
	];
	
	// ì§€ì—­ë³„ ê·¸ë£¹ ë°ì´í„°
	const regionGroups: FoodGroup[] = [
		{
			id: 'region-1',
			name: 'ì„œìš¸ ê°•ë‚¨êµ¬ ë§›ì§‘',
			description: 'ê°•ë‚¨êµ¬ ì§€ì—­ ë§›ì§‘ ëª¨ìŒ',
			memberCount: 1420,
			placeCount: 88,
			thumbnail: 'https://placehold.co/600x400?text=ê°•ë‚¨ë§›ì§‘',
			tags: ['ì„œìš¸', 'ê°•ë‚¨êµ¬', 'ì§€ì—­'],
			isOfficial: true,
			isHot: true,
			isNew: false,
			isAutoGenerated: false
		},
		{
			id: 'region-2',
			name: 'ì„œìš¸ ë§ˆí¬êµ¬ ë§›ì§‘',
			description: 'ë§ˆí¬êµ¬ ì§€ì—­ ë§›ì§‘ ëª¨ìŒ',
			memberCount: 986,
			placeCount: 65,
			thumbnail: 'https://placehold.co/600x400?text=ë§ˆí¬ë§›ì§‘',
			tags: ['ì„œìš¸', 'ë§ˆí¬êµ¬', 'ì§€ì—­'],
			isOfficial: true,
			isHot: false,
			isNew: false,
			isAutoGenerated: false
		},
		{
			id: 'region-3',
			name: 'ë¶€ì‚° í•´ìš´ëŒ€êµ¬ ë§›ì§‘',
			description: 'í•´ìš´ëŒ€êµ¬ ì§€ì—­ ë§›ì§‘ ëª¨ìŒ',
			memberCount: 754,
			placeCount: 43,
			thumbnail: 'https://placehold.co/600x400?text=í•´ìš´ëŒ€ë§›ì§‘',
			tags: ['ë¶€ì‚°', 'í•´ìš´ëŒ€êµ¬', 'ì§€ì—­'],
			isOfficial: true,
			isHot: false,
			isNew: true,
			isAutoGenerated: false
		}
	];
	
	// ëª¨ë“  ê·¸ë£¹ ë°ì´í„° ê²°í•©
	let groups = $state([...automatedGroups, ...userGroups, ...regionGroups]);
	
	// í•„í„°ë§ëœ ê·¸ë£¹
	let filteredGroups = $state<FoodGroup[]>([]);
	
	// ë‚´ ê·¸ë£¹ (ê°€ì…í•œ ê·¸ë£¹)
	const myGroups = ['1', '5', 'region-1']; // ê°€ì…í•œ ê·¸ë£¹ ID ëª©ë¡
	
	// ê·¸ë£¹ í•„í„°ë§ í•¨ìˆ˜
	function filterGroups() {
		if (searchQuery.trim() !== '') {
			// ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ ê²€ìƒ‰ì–´ë¡œ í•„í„°ë§
			filteredGroups = groups.filter(group => 
				group.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
				group.description.toLowerCase().includes(searchQuery.toLowerCase()) ||
				group.tags.some(tag => tag.toLowerCase().includes(searchQuery.toLowerCase()))
			);
		} else {
			// ì¹´í…Œê³ ë¦¬ë³„ í•„í„°ë§
			const currentTab = tabs[activeTab].id;
			switch(currentTab) {
				case 'auto':
					filteredGroups = groups.filter(group => group.isAutoGenerated);
					break;
				case 'popular':
					filteredGroups = groups.filter(group => group.isHot && !group.isAutoGenerated);
					break;
				case 'my':
					filteredGroups = groups.filter(group => myGroups.includes(group.id));
					break;
				case 'region':
					filteredGroups = regionGroups;
					break;
				default:
					filteredGroups = groups;
			}
		}
	}
	
	// ì¹´í…Œê³ ë¦¬ ë³€ê²½ í•¨ìˆ˜
	function handleTabChange(index: number) {
		activeTab = index;
		searchQuery = '';
		filterGroups();
		
		// ìŠ¤í¬ë¡¤ì„ ë§¨ ìœ„ë¡œ ì´ë™
		scrollManager.scrollToTop('auto');
	}
	
	// ê²€ìƒ‰ í•¨ìˆ˜
	function handleSearch(event: Event) {
		event.preventDefault();
		filterGroups();
	}
	
	// ê·¸ë£¹ ìƒì„± ëª¨ë‹¬ í† ê¸€
	function toggleCreateModal() {
		showCreateModal = !showCreateModal;
	}
	
	// ìˆ«ì í¬ë§·íŒ… (1000 -> 1,000)
	function formatNumber(num: number): string {
		return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
	}
	
	// ê·¸ë£¹ í´ë¦­ í•¸ë“¤ëŸ¬
	function handleGroupClick(groupId: string) {
		console.log(`ê·¸ë£¹ í´ë¦­: ${groupId}`);
		selectedGroupId = groupId;
		showDetail = true;
	}
	
	// ìƒì„¸ í˜ì´ì§€ ë‹«ê¸°
	function closeDetail() {
		showDetail = false;
		selectedGroupId = null;
	}
	
	// ì´ˆê¸° ë°ì´í„° ë¡œë“œ ë° ìŠ¤í¬ë¡¤ ê´€ë ¨ ì„¤ì •
	onMount(() => {
		// ì´ˆê¸° í•„í„°ë§
		filterGroups();
		
		// ìŠ¤í¬ë¡¤ ë§¤ë‹ˆì € ì´ˆê¸°í™”
		const cleanup = scrollManager.initialize();
		
		// ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆ ìš”ì†Œ ì„¤ì •
		if (scrollableArea) {
			scrollManager.setContainerElement(scrollableArea);
		}
		
		// ìœ„ë¡œ ìŠ¤í¬ë¡¤ ì‹œ í—¤ë” í‘œì‹œ
		const unsubscribeScrollUp = scrollManager.onDirectionChange(
			ScrollDirection.UP,
			() => {
				if (!showNav) {
					showNav = true;
				}
			}
		);
		
		// ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤ ì‹œ í—¤ë” ìˆ¨ê¹€
		const unsubscribeScrollDown = scrollManager.onDirectionChange(
			ScrollDirection.DOWN,
			() => {
				if (showNav) {
					showNav = false;
				}
			}
		);
		
		// ì»´í¬ë„ŒíŠ¸ ì •ë¦¬ í•¨ìˆ˜ ë°˜í™˜
		return () => {
			cleanup();
			unsubscribeScrollUp();
			unsubscribeScrollDown();
		};
	});
	
	// ê·¸ë£¹ ìƒì„± í¼ ë°ì´í„°
	let newGroup = $state({
		name: '',
		description: '',
		isPrivate: false,
		tags: [] as string[],
		category: ''
	});
	
	// íƒœê·¸ ì…ë ¥ ê´€ë¦¬
	let tagInput = $state('');
	
	// íƒœê·¸ ì¶”ê°€
	function addTag() {
		if (tagInput.trim() && !newGroup.tags.includes(tagInput.trim())) {
			newGroup.tags = [...newGroup.tags, tagInput.trim()];
			tagInput = '';
		}
	}
	
	// íƒœê·¸ ì‚­ì œ
	function removeTag(tag: string) {
		newGroup.tags = newGroup.tags.filter(t => t !== tag);
	}
	
	// ê·¸ë£¹ ìƒì„± ì²˜ë¦¬
	function createGroup() {
		console.log('ìƒˆ ê·¸ë£¹ ìƒì„±:', newGroup);
		// ì‹¤ì œë¡œëŠ” ì—¬ê¸°ì„œ API í˜¸ì¶œí•˜ì—¬ ê·¸ë£¹ ìƒì„±
		toggleCreateModal();
		// í¼ ì´ˆê¸°í™”
		newGroup = {
			name: '',
			description: '',
			isPrivate: false,
			tags: [],
			category: ''
		};
	}
	
	// í”„ë¡œí•„ í´ë¦­ í•¸ë“¤ëŸ¬
	function handleProfileClick() {
		// í”„ë¡œí•„ í´ë¦­ ì²˜ë¦¬
		console.log('í”„ë¡œí•„ í´ë¦­');
	}
	
	// ê²€ìƒ‰ í´ë¦­ í•¸ë“¤ëŸ¬
	function handleSearchClick() {
		// ê²€ìƒ‰ í´ë¦­ ì²˜ë¦¬
		console.log('ê²€ìƒ‰ í´ë¦­');
	}
	
	// ê·¸ë£¹ ìƒì„± í´ë¦­ í•¸ë“¤ëŸ¬
	function handleCreateGroupClick() {
		showCreateModal = true;
		console.log('ê·¸ë£¹ ìƒì„± í´ë¦­');
	}
</script>

<div class="scroll-container" bind:this={scrollableArea}>
	<div class="fixed top-0 left-0 right-0 z-30 transition-transform duration-300 ease-in-out bg-white"
		 style="transform: translateY({showNav ? '0' : '-100%'})">
		<Header 
			on:profileClick={handleProfileClick}
			on:searchClick={handleSearchClick}
			on:createGroupClick={handleCreateGroupClick}
		/>
		<Tabs 
			tabs={tabs} 
			activeTab={activeTab} 
			onChange={handleTabChange} 
		/>
	</div>
	
	<!-- ë©”ì¸ ì»¨í…ì¸  -->
	<div class="mx-auto max-w-lg px-0 py-4 pt-30 pb-45 sm:px-4">
		<!-- íƒ­ ì„¤ëª… ë°•ìŠ¤ -->
		<!-- <div class="mb-2 p-3 bg-gray-50 rounded-lg border border-gray-200">
			<div class="flex items-center gap-2 text-gray-700">
				<span class="text-lg">ğŸ’¡</span>
				<p class="text-sm font-medium">{tabs[activeTab].desc}</p>
			</div>
		</div> -->

		{#if filteredGroups.length > 0}
			<!-- ì¶”ì²œ ê·¸ë£¹ ì„¹ì…˜ -->
			{#if tabs[activeTab].id === 'auto' && filteredGroups.filter(g => g.isAutoGenerated).length > 0}
				<div class="mb-8">
					<h2 class="text-lg font-bold mb-4">ë‚˜ë¥¼ ìœ„í•œ ë§ì¶¤ ê·¸ë£¹</h2>
					
					<div class="space-y-4">
						{#each filteredGroups.filter(g => g.isAutoGenerated) as group}
							<div 
								class="bg-white rounded-xl overflow-hidden border border-gray-200 shadow-sm"
								onclick={() => handleGroupClick(group.id)}
							>
								<div class="relative h-36 overflow-hidden">
									<img src={group.thumbnail} alt={group.name} class="w-full h-full object-cover" />
									<div class="absolute inset-0 bg-gradient-to-b from-black/10 to-black/70"></div>
									<div class="absolute bottom-3 left-3 text-white">
										<h3 class="font-bold">{group.name}</h3>
										<p class="text-xs text-white/80 mt-1">{group.description}</p>
									</div>
								</div>
								<div class="p-3 flex justify-between items-center">
									<div class="flex items-center gap-3 text-xs text-gray-500">
										<div class="flex items-center gap-1">
											<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
											</svg>
											<span>{formatNumber(group.placeCount)}ê°œ</span>
										</div>
									</div>
									<button class="px-3 py-1 rounded-full bg-purple-50 text-purple-600 font-medium hover:bg-purple-100 transition-colors">
										ë‘˜ëŸ¬ë³´ê¸°
									</button>
								</div>
							</div>
						{/each}
					</div>
				</div>
			{/if}
			
			<!-- ì¼ë°˜ ê·¸ë£¹ ëª©ë¡ -->
			<div class="space-y-4">
				{#each filteredGroups.filter(g => !g.isAutoGenerated || tabs[activeTab].id !== 'auto') as group}
					<div 
						class="bg-white rounded-xl overflow-hidden border border-gray-200 shadow-sm"
						onclick={() => handleGroupClick(group.id)}
					>
						<div class="flex">
							<div class="w-24 h-24 overflow-hidden">
								<img src={group.thumbnail} alt={group.name} class="w-full h-full object-cover" />
							</div>
							<div class="flex-1 p-3 flex flex-col">
								<div class="flex items-center">
									<h3 class="font-bold text-gray-900">{group.name}</h3>
									{#if group.isOfficial}
										<span class="ml-2 px-1.5 py-0.5 bg-blue-100 text-blue-600 text-xs rounded-full">ê³µì‹</span>
									{/if}
									{#if group.isNew}
										<span class="ml-2 px-1.5 py-0.5 bg-green-100 text-green-600 text-xs rounded-full">NEW</span>
									{/if}
									{#if group.isHot}
										<span class="ml-2 px-1.5 py-0.5 bg-red-100 text-red-600 text-xs rounded-full">HOT</span>
									{/if}
								</div>
								<p class="text-xs text-gray-500 mt-1 line-clamp-2">{group.description}</p>
								<div class="flex flex-wrap gap-1 mt-1">
									{#each group.tags.slice(0, 3) as tag}
										<span class="px-1.5 py-0.5 bg-gray-100 text-gray-600 text-xs rounded-full">#{tag}</span>
									{/each}
								</div>
								<div class="mt-auto pt-2 flex justify-between items-center">
									<div class="flex items-center gap-3 text-xs text-gray-500">
										<div class="flex items-center gap-1">
											<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
											</svg>
											<span>{formatNumber(group.memberCount)}ëª…</span>
										</div>
										<div class="flex items-center gap-1">
											<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
											</svg>
											<span>{formatNumber(group.placeCount)}ê°œ</span>
										</div>
									</div>
									{#if !group.isAutoGenerated && !myGroups.includes(group.id)}
										<button class="px-3 py-1 rounded-full bg-blue-50 text-blue-600 font-medium hover:bg-blue-100 transition-colors">
											ì°¸ì—¬í•˜ê¸°
										</button>
									{:else if !group.isAutoGenerated && myGroups.includes(group.id)}
										<button class="px-3 py-1 rounded-full bg-gray-100 text-gray-500 font-medium hover:bg-gray-200 transition-colors">
											íƒˆí‡´í•˜ê¸°
										</button>
									{:else}
										<button class="px-3 py-1 rounded-full bg-purple-50 text-purple-600 font-medium hover:bg-purple-100 transition-colors">
											ë‘˜ëŸ¬ë³´ê¸°
										</button>
									{/if}
								</div>
							</div>
						</div>
					</div>
				{/each}
			</div>
		{:else}
			<!-- ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ -->
			<div class="bg-white rounded-xl p-8 text-center">
				<svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
				</svg>
				<p class="text-gray-500 text-lg mb-2">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
				<p class="text-gray-400 text-sm">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ì‹œë„í•´ë³´ì„¸ìš”</p>
			</div>
		{/if}
	</div>
</div>

<!-- ê·¸ë£¹ ìƒì„¸ ëª¨ë‹¬ -->
{#if showDetail && selectedGroupId}
	<GroupDetail 
		groupId={selectedGroupId}
		onClose={closeDetail}
	/>
{/if}

<!-- ê·¸ë£¹ ìƒì„± ëª¨ë‹¬ -->
{#if showCreateModal}
	<div class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
		<div class="bg-white rounded-xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
			<!-- í—¤ë” -->
			<div class="p-4 border-b border-gray-200 flex justify-between items-center">
				<h2 class="text-lg font-bold">ìƒˆ ê·¸ë£¹ ë§Œë“¤ê¸°</h2>
				<button 
					class="p-1 rounded-full hover:bg-gray-100"
					onclick={toggleCreateModal}
				>
					<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
					</svg>
				</button>
			</div>
			
			<!-- í¼ -->
			<div class="p-4">
				<div class="mb-4">
					<label for="group-name" class="block text-sm font-medium text-gray-700 mb-1">ê·¸ë£¹ ì´ë¦„</label>
					<input 
						id="group-name"
						type="text" 
						bind:value={newGroup.name}
						placeholder="ê·¸ë£¹ ì´ë¦„ ì…ë ¥"
						class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
					/>
				</div>
				
				<div class="mb-4">
					<label for="group-description" class="block text-sm font-medium text-gray-700 mb-1">ê·¸ë£¹ ì„¤ëª…</label>
					<textarea 
						id="group-description"
						bind:value={newGroup.description}
						placeholder="ê·¸ë£¹ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
						class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
						rows="3"
					></textarea>
				</div>
				
				<div class="mb-4">
					<label for="group-tags" class="block text-sm font-medium text-gray-700 mb-1">íƒœê·¸</label>
					<div class="flex items-center mb-2">
						<input 
							id="group-tags"
							type="text" 
							bind:value={tagInput}
							onkeydown={(e) => e.key === 'Enter' && addTag()}
							placeholder="íƒœê·¸ ì…ë ¥ í›„ Enter"
							class="flex-1 px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
						/>
						<button 
							class="px-3 py-2 bg-blue-500 text-white rounded-r-md hover:bg-blue-600"
							onclick={addTag}
						>
							ì¶”ê°€
						</button>
					</div>
					
					{#if newGroup.tags.length > 0}
						<div class="flex flex-wrap gap-2">
							{#each newGroup.tags as tag}
								<div class="inline-flex items-center gap-1 bg-gray-100 px-2 py-1 rounded-full">
									<span class="text-xs text-gray-800">#{tag}</span>
									<button 
										class="text-gray-500 hover:text-gray-700"
										onclick={() => removeTag(tag)}
									>
										<svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
										</svg>
									</button>
								</div>
							{/each}
						</div>
					{/if}
				</div>
				
				<div class="mb-4">
					<label for="group-category" class="block text-sm font-medium text-gray-700 mb-1">ì¹´í…Œê³ ë¦¬</label>
					<select 
						id="group-category"
						bind:value={newGroup.category}
						class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
					>
						<option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
						<option value="restaurant">ì‹ë‹¹</option>
						<option value="cafe">ì¹´í˜</option>
						<option value="bar">ìˆ ì§‘</option>
						<option value="activity">ì•¡í‹°ë¹„í‹°</option>
						<option value="other">ê¸°íƒ€</option>
					</select>
				</div>
				
				<div class="mb-6">
					<label class="flex items-center">
						<input 
							type="checkbox" 
							bind:checked={newGroup.isPrivate}
							class="h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500"
						/>
						<span class="ml-2 text-sm text-gray-700">ë¹„ê³µê°œ ê·¸ë£¹ìœ¼ë¡œ ë§Œë“¤ê¸°</span>
					</label>
					<p class="text-xs text-gray-500 mt-1 pl-6">ë¹„ê³µê°œ ê·¸ë£¹ì€ ì´ˆëŒ€ë¥¼ í†µí•´ì„œë§Œ ê°€ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
				</div>
				
				<!-- ì œì¶œ ë²„íŠ¼ -->
				<div class="flex justify-end">
					<button 
						class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 mr-2"
						onclick={toggleCreateModal}
					>
						ì·¨ì†Œ
					</button>
					<button 
						class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600"
						onclick={createGroup}
						disabled={!newGroup.name.trim() || !newGroup.description.trim()}
					>
						ìƒì„±í•˜ê¸°
					</button>
				</div>
			</div>
		</div>
	</div>
{/if}

<style>
	/* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */
	.scroll-container {
		height: 100vh;
		overflow-y: auto;
		overflow-x: hidden;
		width: 100%;
		position: fixed;
		top: 0;
		left: 0;
		overscroll-behavior-y: contain;
		-webkit-overflow-scrolling: touch;
	}
	
	.scroll-container::-webkit-scrollbar {
		display: none;
	}
	
	/* ìµœëŒ€ 2ì¤„ê¹Œì§€ í‘œì‹œ */
	.line-clamp-2 {
		overflow: hidden;
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
	}
</style>