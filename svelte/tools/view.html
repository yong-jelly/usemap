<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>파일 드래그&드롭 → 시트별 파싱</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <style>
        #drop-area {
            width: 100%;
            height: 200px;
            border: 3px dashed #888;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px 0;
            color: #888;
            font-size: 1.5em;
        }
    </style>
</head>

<body>
    <h3>파일을 드래그해서 시트별로 파싱하기</h3>
    <div id="drop-area">여기에 파일을 드롭하세요 (html, xls, xlsx)</div>
    <div id="output"></div>

    <script>
        const dropArea = document.getElementById('drop-area');
        const output = document.getElementById('output');

        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.style.background = "#e0f7fa";
        });

        dropArea.addEventListener('dragleave', (e) => {
            dropArea.style.background = "";
        });

        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.style.background = "";
            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        function handleFiles(files) {
            [...files].forEach(file => {
                if (file.name.endsWith('.xls') || file.name.endsWith('.xlsx')) {
                    parseExcel(file);
                } else if (file.name.endsWith('.html')) {
                    parseHTML(file);
                } else {
                    output.innerHTML += `<p style="color: red">${file.name} - 지원하지 않는 파일 타입입니다.</p>`;
                }
            });
        }

        function parseExcel(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {
                    type: 'array'
                });

                // 시트 전체 데이터를 하나의 배열로 합치기
                let mergedRows = [];

                for (const sheetName of workbook.SheetNames) {
                    // header:1 대신 기본 옵션 사용 → [{컬럼:값}, ...] 반환
                    const rows = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);
                    mergedRows = mergedRows.concat(rows);
                }

                // 구조화된 json 결과만 콘솔에 출력 (예쁘게 들여쓰기)
                console.log(JSON.stringify(mergedRows, null, 2));
            };
            reader.readAsArrayBuffer(file);
        }

        function renderSheet(sheetName, sheetData) {
            let html = `<h4>[${sheetName}] 시트</h4><table border="1" cellpadding="4">`;
            for (const row of sheetData) {
                html += "<tr>";
                for (const cell of row) {
                    html += `<td>${cell ?? ""}</td>`;
                }
                html += "</tr>";
            }
            html += "</table>";
            output.innerHTML += html;
        }

        function parseHTML(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(e.target.result, "text/html");
                // 시트별 구분이 없고 테이블 단위로 파싱하는 예시
                let tables = doc.querySelectorAll('table');
                let idx = 1;
                tables.forEach(table => {
                    output.innerHTML += `<h4>[HTML Table #${idx++}]</h4>` + table.outerHTML;
                });
            };
            reader.readAsText(file, 'utf-8');
        }
    </script>
</body>

</html>