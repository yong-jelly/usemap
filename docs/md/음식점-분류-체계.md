# 음식점 분류 체계

## 개요

`tbl_place` 테이블의 `category_code_list[1]` (루트 카테고리 코드)를 기준으로 음식점 여부를 판별할 수 있다.

## 카테고리 루트 코드별 분포

| 루트 코드 | 분류 | 장소 수 | 비율 |
|-----------|------|---------|------|
| **220036** | 음식점 | 911,452 | ~97% |
| 225111 | 산업/제조업 | 18,838 | ~2% |
| 223563 | 쇼핑 | 2,674 | ~0.3% |
| 226187 | 교통시설 | 5 | - |
| 기타 | 관광/숙박/문화 등 | ~500 | - |

## 음식점 판별 규칙

### 기본 규칙

```sql
-- 음식점인 경우
WHERE category_code_list[1] = '220036'
```

### 음식점 카테고리 (220036 하위) 예시

- 한식, 중식당, 일식당, 양식
- 카페,디저트, 카페, 베이커리, 다방
- 육류,고기요리, 돼지고기구이, 소고기구이
- 치킨,닭강정, 닭요리
- 종합분식, 김밥, 떡볶이
- 맥주,호프, 요리주점, 바(BAR), 이자카야
- 생선회, 해물,생선요리
- 족발,보쌈, 곱창,막창,양
- 칼국수,만두, 국밥, 국수, 냉면
- 피자, 햄버거, 돈가스
- 한식뷔페, 순대,순댓국
- 등 (대다수의 음식 관련 카테고리)

### 음식점으로 포함해야 할 예외 케이스

| 카테고리 | 루트 코드 | 비고 |
|----------|-----------|------|
| 떡,한과 | 223563 (쇼핑) | 음식 판매점으로 포함 권장 |

## 비음식점 (제외 대상)

### 223563 (쇼핑) 하위 - 제외

- 슈퍼,마트
- 서점, 독립서점
- 직판장
- 정육점, 반찬가게
- 농수산물, 건어물, 수산물
- 종합가전, 전자,가전
- 철물점, 건축자재,용품
- 스포츠용품, 자전거
- 특산물,관광민예품
- 등

### 225111 (산업/제조업) 하위 - 제외

- 폐기물수집,처리업
- 건물,구축물해체공사
- 청소
- 인쇄업, 제조업
- 밸브제조, 펌프,압축기제조
- 빵류제조, 떡류제조, 면류제조
- 수산물가공,제조
- IT서비스
- 등

### 226187 (교통시설) 하위 - 제외

- 시외버스터미널
- 고속도로휴게소
- 일반휴게소

### 기타 제외 대상

- **222117**: 거리,골목, 먹자거리 등 (장소 유형)
- **221941/221986**: 숙박 (모텔, 호텔, 펜션, 민박 등)
- **221845**: 문화시설 (박물관, 미술관, 도서관 등)
- **223267**: 편의점

## 테이블별 음식점 여부

| 테이블 | 음식점 여부 | 비고 |
|--------|-------------|------|
| `tbl_place` | 혼재 | `category_code_list[1] = '220036'`로 필터링 필요 |
| `tbl_naver_folder` | 거의 음식점 | 사용자 저장 폴더, 대부분 음식점 |
| `tbl_naver_folder_place` | 거의 음식점 | 네이버 폴더 내 장소 |
| `tbl_place_features` | **항상 음식점** | 음식점 특성 분석 데이터만 포함 |

## SQL 예시

### 음식점만 조회

```sql
SELECT * FROM tbl_place 
WHERE category_code_list[1] = '220036';
```

### 음식점 + 떡,한과 포함

```sql
SELECT * FROM tbl_place 
WHERE category_code_list[1] = '220036'
   OR category = '떡,한과';
```

### 비음식점만 조회

```sql
SELECT * FROM tbl_place 
WHERE category_code_list[1] != '220036'
   OR category_code_list IS NULL;
```

### 비음식점 카테고리 분포 확인

```sql
SELECT category, COUNT(*) 
FROM tbl_place 
WHERE category_code_list[1] != '220036'
GROUP BY 1 
ORDER BY 2 DESC;
```

## 비음식점 데이터 제거 쿼리

### tbl_place에서 비음식점 삭제

```sql
-- 삭제 전 확인 (비음식점 수)
SELECT COUNT(*) FROM tbl_place 
WHERE category_code_list[1] != '220036'
   OR category_code_list IS NULL;

-- 비음식점 삭제 (떡,한과는 유지)
DELETE FROM tbl_place 
WHERE (category_code_list[1] != '220036' OR category_code_list IS NULL)
  AND category != '떡,한과';
```

### tbl_naver_folder_place에서 비음식점 삭제

```sql
-- 비음식점 place_id를 참조하는 레코드 삭제
DELETE FROM tbl_naver_folder_place 
WHERE place_id IN (
  SELECT id FROM tbl_place 
  WHERE (category_code_list[1] != '220036' OR category_code_list IS NULL)
    AND category != '떡,한과'
);
```

### 연관 테이블 포함 전체 정리 (순서 중요)

```sql
-- 1. tbl_folder_review 삭제
DELETE FROM tbl_folder_review 
WHERE place_id IN (
  SELECT id FROM tbl_place 
  WHERE (category_code_list[1] != '220036' OR category_code_list IS NULL)
    AND category != '떡,한과'
);

-- 2. tbl_folder_place 삭제
DELETE FROM tbl_folder_place 
WHERE place_id IN (
  SELECT id FROM tbl_place 
  WHERE (category_code_list[1] != '220036' OR category_code_list IS NULL)
    AND category != '떡,한과'
);

-- 3. tbl_naver_folder_place 삭제
DELETE FROM tbl_naver_folder_place 
WHERE place_id IN (
  SELECT id FROM tbl_place 
  WHERE (category_code_list[1] != '220036' OR category_code_list IS NULL)
    AND category != '떡,한과'
);

-- 4. tbl_instagram_place 삭제
DELETE FROM tbl_instagram_place 
WHERE place_id IN (
  SELECT id FROM tbl_place 
  WHERE (category_code_list[1] != '220036' OR category_code_list IS NULL)
    AND category != '떡,한과'
);

-- 5. tbl_place 삭제
DELETE FROM tbl_place 
WHERE (category_code_list[1] != '220036' OR category_code_list IS NULL)
  AND category != '떡,한과';
```

## 집계 쿼리

### 루트 카테고리별 장소 수

```sql
SELECT 
  category_code_list[1] AS root_code,
  COUNT(*) AS cnt
FROM tbl_place 
WHERE category_code_list IS NOT NULL
GROUP BY 1 
ORDER BY 2 DESC;
```

### 음식점 vs 비음식점 비율

```sql
SELECT 
  CASE 
    WHEN category_code_list[1] = '220036' THEN '음식점'
    ELSE '비음식점'
  END AS type,
  COUNT(*) AS cnt,
  ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 2) AS pct
FROM tbl_place
GROUP BY 1;
```

### 상위 20개 카테고리 (음식점만)

```sql
SELECT category, COUNT(*) AS cnt
FROM tbl_place 
WHERE category_code_list[1] = '220036'
GROUP BY 1 
ORDER BY 2 DESC 
LIMIT 20;
```

### 상위 20개 카테고리 (비음식점만)

```sql
SELECT category, category_code_list[1] AS root_code, COUNT(*) AS cnt
FROM tbl_place 
WHERE category_code_list[1] != '220036'
GROUP BY 1, 2
ORDER BY 3 DESC 
LIMIT 20;
```

### 테이블별 레코드 수 현황

```sql
SELECT 'tbl_place' AS table_name, COUNT(*) AS cnt FROM tbl_place
UNION ALL
SELECT 'tbl_place (음식점)', COUNT(*) FROM tbl_place WHERE category_code_list[1] = '220036'
UNION ALL
SELECT 'tbl_naver_folder', COUNT(*) FROM tbl_naver_folder
UNION ALL
SELECT 'tbl_naver_folder_place', COUNT(*) FROM tbl_naver_folder_place
UNION ALL
SELECT 'tbl_place_features', COUNT(*) FROM tbl_place_features
UNION ALL
SELECT 'tbl_folder_place', COUNT(*) FROM tbl_folder_place;
```

### 리뷰 수 기준 상위 음식점

```sql
SELECT id, name, category, visitor_reviews_total, visitor_reviews_score
FROM tbl_place 
WHERE category_code_list[1] = '220036'
ORDER BY visitor_reviews_total DESC NULLS LAST
LIMIT 20;
```

### 지역별(group1) 음식점 분포

```sql
SELECT group1, COUNT(*) AS cnt
FROM tbl_place 
WHERE category_code_list[1] = '220036'
  AND group1 IS NOT NULL
GROUP BY 1 
ORDER BY 2 DESC;
```
