# Queue PM2 운영 가이드

이 문서는 PM2를 사용하여 `tools/cli/queue.ts` 스크립트를 주기적으로(1분 간격) 실행하는 방법을 설명합니다.

## 1. 프로세스 시작 (1분 주기 실행)

별도의 설정 파일 없이 터미널에서 직접 다음 명령어를 실행하여 등록할 수 있습니다.

```bash
pm2 start "bun run tools/cli/queue.ts --batch 10" --name "queue-worker" --cron "*/1 * * * *" --no-autorestart
```

### 옵션 상세 설명
- `--name "queue-worker"`: PM2 관리 목록에서 식별할 프로세스 이름을 지정합니다.
- `--cron "*/1 * * * *"`: **1분마다** 프로세스를 재시작(실행)하도록 설정하는 표준 크론 스케줄러 옵션입니다.
- `--no-autorestart`: 프로세스가 작업을 완료하고 정상 종료(`exit 0`)되었을 때 PM2가 즉시 다시 살리지 않도록 설정합니다. 이 설정을 통해 다음 1분 주기가 올 때까지 대기하게 됩니다.

---

## 2. 주요 관리 명령어

등록된 프로세스를 관리하기 위한 주요 명령어들입니다.

### 상태 확인
현재 프로세스의 상태(실행 중인 경우 `online`, 대기 중인 경우 `stopped`)를 확인합니다.
```bash
pm2 list
```

### 로그 모니터링
스크립트의 실행 결과 및 에러 로그를 실시간으로 확인합니다.
```bash
pm2 logs queue-worker
```

### 프로세스 중지 및 재시작
```bash
# 스케줄링 중지
pm2 stop queue-worker

# 스케줄링 다시 시작
pm2 start queue-worker
```

### 프로세스 삭제
목록에서 완전히 제거합니다.
```bash
pm2 delete queue-worker
```

### 설정 저장 (서버 재부팅 대비)
현재 실행 중인 PM2 프로세스 목록을 저장하여, 서버가 재부팅된 후에도 자동으로 다시 시작되게 합니다.
```bash
pm2 save
```

---

## 3. 작동 원리
1. 프로세스가 실행되어 작업을 처리합니다.
2. 작업이 끝나면 프로세스는 스스로 종료됩니다.
3. `--no-autorestart` 옵션 덕분에 PM2는 즉시 재시작하지 않습니다.
4. `--cron` 설정에 의해 정각(매 1분)이 되면 PM2가 다시 프로세스를 실행시킵니다.
